<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update JSON File</title>
</head>
<body>
    <h2>Update JSON Data</h2>

    <label>Title:</label>
    <input type="text" id="title"><br><br>

    <label>Image URL:</label>
    <input type="text" id="image"><br><br>

    <label>Link URL:</label>
    <input type="text" id="link"><br><br>

    <button onclick="updateJSON()">Update JSON</button>

    <script>
        async function updateJSON() {
            const token = "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"; // अपना GitHub Token डालें
            const repo = "rdsteam18/NETLIFY"; // अपनी GitHub Repository डालें
            const filePath = "animeData.json"; // JSON फाइल का Path
            const apiUrl = `https://api.github.com/repos/${repo}/contents/${filePath}`;

            // यूज़र द्वारा इनपुट किए गए डेटा को लें
            const newEntry = {
                title: document.getElementById("title").value,
                image: document.getElementById("image").value,
                link: document.getElementById("link").value
            };

            try {
                // GitHub API से Existing JSON डेटा लोड करें
                const response = await fetch(apiUrl, {
                    headers: {
                        Authorization: `token ${token}`,
                        Accept: "application/vnd.github.v3+json"
                    }
                });

                if (!response.ok) {
                    alert("❌ Error fetching file: " + response.statusText);
                    return;
                }

                const fileData = await response.json();
                const sha = fileData.sha; // पुरानी फाइल का SHA
                let existingData = JSON.parse(atob(fileData.content)); // Base64 से JSON में बदलें

                // नया डेटा जोड़ें
                existingData.push(newEntry);

                // JSON को अपडेट करें
                const updatedContent = btoa(unescape(encodeURIComponent(JSON.stringify(existingData, null, 2))));

                // अब GitHub पर JSON अपडेट करें
                const updateResponse = await fetch(apiUrl, {
                    method: "PUT",
                    headers: {
                        Authorization: `token ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        message: "Added new anime data",
                        content: updatedContent,
                        sha: sha
                    })
                });

                if (updateResponse.ok) {
                    alert("✅ JSON फाइल सफलतापूर्वक अपडेट हो गई!");
                } else {
                    alert("❌ JSON अपडेट में समस्या आई!");
                }
            } catch (error) {
                alert("❌ Error: " + error.message);
            }
        }
    </script>
</body>
</html>
